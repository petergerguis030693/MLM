<div class="header">
  <div class="header-content">
    <nav class="navbar navbar-expand">
      <div class="collapse navbar-collapse justify-content-between">
        <div class="header-left">
          <div class="dashboard_bar">
            <%= typeof headerTitle !=='undefined' ? headerTitle : 'Dashboard' %>
          </div>
          <% if (typeof greeting !== 'undefined') { %>
            <div class="greeting-message">
              <h4><%= greeting %></h4> <!-- Begr√º√üungsnachricht anzeigen -->
            </div>
          <% } %>
        </div>
        <ul class="navbar-nav header-right">
          <!--<li class="nav-item d-flex align-items-center">
            <div class="input-group search-area">
              <input type="text" class="form-control" placeholder="Search here...">
              <span class="input-group-text">
                <a href="javascript:void(0)">
                  <i class="flaticon-381-search-2"></i>
                </a>
              </span>
            </div>
          </li>-->
          <li class="nav-item dropdown notification_dropdown">
            <a class="nav-link bell dz-theme-mode" href="javascript:void(0);">
              <i id="icon-light" class="fas fa-sun"></i>
              <i id="icon-dark" class="fas fa-moon"></i>
            </a>
          </li>
          <!--<li class="nav-item dropdown notification_dropdown">
            <a class="nav-link" href="javascript:void(0);" data-bs-toggle="dropdown">
              <svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M26.7727 10.8757C26.7043 10.6719 26.581 10.4909 26.4163 10.3528C26.2516 10.2146 26.0519 10.1247 25.8393 10.0929L18.3937 8.95535L15.0523 1.83869C14.9581 1.63826 14.8088 1.46879 14.6218 1.35008C14.4349 1.23137 14.218 1.16833 13.9965 1.16833C13.775 1.16833 13.5581 1.23137 13.3712 1.35008C13.1842 1.46879 13.0349 1.63826 12.9407 1.83869L9.59934 8.95535L2.15367 10.0929C1.9416 10.1252 1.74254 10.2154 1.57839 10.3535C1.41423 10.4916 1.29133 10.6723 1.22321 10.8757C1.15508 11.0791 1.14436 11.2974 1.19222 11.5065C1.24008 11.7156 1.34468 11.9075 1.49451 12.061L6.92067 17.6167L5.63734 25.4777C5.60232 25.6934 5.6286 25.9147 5.7132 26.1162C5.79779 26.3177 5.93729 26.4914 6.1158 26.6175C6.29432 26.7436 6.50466 26.817 6.72287 26.8294C6.94108 26.8418 7.15838 26.7926 7.35001 26.6875L14 23.0149L20.65 26.6875C20.8416 26.7935 21.0592 26.8434 21.2779 26.8316C21.4965 26.8197 21.7075 26.7466 21.8865 26.6205C22.0655 26.4944 22.2055 26.3204 22.2903 26.1186C22.3751 25.9167 22.4014 25.695 22.3662 25.4789L21.0828 17.6179L26.5055 12.061C26.6546 11.9071 26.7585 11.715 26.8056 11.5059C26.8527 11.2968 26.8413 11.0787 26.7727 10.8757Z"
                  fill="#717579" />
              </svg>
              <span class="badge light text-white bg-secondary rounded-circle">76</span>
            </a>
           <div class="dropdown-menu dropdown-menu-end">
              <div class="p-3 pb-0">
                <div class="row">
                  <div class="col-xl-12 border-bottom">
                    <h5 class="">Related Apps</h5>
                  </div>
                  <div class="col-4 my-3">
                    <div class="text-center">
                      <div class="angular-svg">
                        <img src="images/svg/angular.svg" alt="">
                        <div class="content">
                          <small>Angular</small>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-4 my-3">
                  <div class="text-center">
                    <div class="angular-svg">
                      <img src="images/svg/figma.svg" alt="">
                      <div class="content">
                        <small>Figma</small>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-4 my-3">
                  <div class="text-center">
                    <div class="angular-svg">
                      <img src="images/svg/dribbble.svg" alt="">
                      <div class="content">
                        <small>Dribbble</small>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-4">
                  <div class="text-center">
                    <div class="angular-svg">
                      <img src="images/svg/instagram.svg" alt="">
                      <div class="content">
                        <small>instagram</small>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-4">
                  <div class="text-center">
                    <div class="angular-svg">
                      <img src="images/svg/laravel-2.svg" alt="">
                      <div class="content">
                        <small>Laravel</small>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-4">
                  <div class="text-center">
                    <div class="angular-svg">
                      <img src="images/svg/react-2.svg" alt="">
                      <div class="content">
                        <small>React</small>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>-->
      </div>
      </li>
      <li class="nav-item dropdown notification_dropdown">
        <a class="nav-link" href="javascript:void(0);" role="button" data-bs-toggle="dropdown">
            <svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M23.3333 19.8333H23.1187C23.2568 19.4597 23.3295 19.065 23.3333 18.6666V12.8333C23.3294 10.7663 22.6402 8.75902 21.3735 7.12565C20.1068 5.49228 18.3343 4.32508 16.3333 3.80679V3.49996C16.3333 2.88112 16.0875 2.28763 15.6499 1.85004C15.2123 1.41246 14.6188 1.16663 14 1.16663C13.3812 1.16663 12.7877 1.41246 12.3501 1.85004C11.9125 2.28763 11.6667 2.88112 11.6667 3.49996V3.80679C9.66574 4.32508 7.89317 5.49228 6.6265 7.12565C5.35983 8.75902 4.67058 10.7663 4.66667 12.8333V18.6666C4.67053 19.065 4.74316 19.4597 4.88133 19.8333H4.66667C4.35725 19.8333 4.0605 19.9562 3.84171 20.175C3.62292 20.3938 3.5 20.6905 3.5 21C3.5 21.3094 3.62292 21.6061 3.84171 21.8249C4.0605 22.0437 4.35725 22.1666 4.66667 22.1666H23.3333C23.6428 22.1666 23.9395 22.0437 24.1583 21.8249C24.3771 21.6061 24.5 21.3094 24.5 21C24.5 20.6905 24.3771 20.3938 24.1583 20.175C23.9395 19.9562 23.6428 19.8333 23.3333 19.8333Z" fill="#717579"/>
            </svg>
            <span id="notificationBadge" class="badge light text-white bg-warning rounded-circle">0</span>
        </a>
    
        <div class="dropdown-menu dropdown-menu-end">
            <div id="navbarMessageList" class="widget-media dlab-scroll p-3" style="height:380px;">
                <ul class="timeline">
                    <!-- Nachrichten werden hier geladen -->
                </ul>
            </div>
            <a class="all-notification" href="/messages">Alle Nachrichten ansehen <i class="ti-arrow-end"></i></a>
        </div>
    </li>
    <script>
        async function loadNotifications() {
            try {
                const response = await fetch('/notifications/messages'); // API-Route f√ºr Benachrichtigungen
                const data = await response.json();
    
                const navbarMessageList = document.getElementById("navbarMessageList");
                navbarMessageList.innerHTML = ""; // Vorherige Nachrichten l√∂schen
    
                if (data.messages.length === 0) {
                    navbarMessageList.innerHTML = `<li><p class="text-center text-muted">Keine neuen Nachrichten</p></li>`;
                } else {
                    data.messages.forEach(msg => {
                        const listItem = document.createElement("li");
                        listItem.innerHTML = `
                            <div class="timeline-panel">
                                <div class="media me-2">
                                    <i class="fa ${msg.is_read ? 'fa-envelope-open text-muted' : 'fa-envelope text-primary'}"></i>
                                </div>
                                <div class="media-body">
                                    <h6 class="mb-1">${msg.sender_name}: ${msg.subject}</h6>
                                    <small class="d-block">${new Date(msg.sent_at).toLocaleString()}</small>
                                    <a href="/messages/${msg.id}" class="text-primary">Lesen</a>
                                </div>
                            </div>
                        `;
                        navbarMessageList.appendChild(listItem);
                    });
                }
    
                // üîî Anzahl der ungelesenen Nachrichten
                const notificationBadge = document.getElementById("notificationBadge");
                notificationBadge.innerText = data.unreadCount > 0 ? data.unreadCount : "";
    
            } catch (error) {
                console.error("Fehler beim Laden der Nachrichten:", error);
            }
        }
    
        // üî• Nachrichten f√ºr die Navbar alle 10 Sekunden aktualisieren
        setInterval(loadNotifications, 10000);
        loadNotifications();
    </script>
      <li class="nav-item dropdown notification_dropdown">
        <a class="nav-link" href="javascript:void(0);" data-bs-toggle="dropdown" id="notificationDropdown">
            <svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M22.1666 5.83331H20.9999V3.49998C20.9999 3.19056 20.877 2.89381 20.6582 2.67502C20.4394 2.45623 20.1427 2.33331 19.8333 2.33331C19.5238 2.33331 19.2271 2.45623 19.0083 2.67502C18.7895 2.89381 18.6666 3.19056 18.6666 3.49998V5.83331H9.33325V3.49998C9.33325 3.19056 9.21034 2.89381 8.99154 2.67502C8.77275 2.45623 8.47601 2.33331 8.16659 2.33331C7.85717 2.33331 7.56042 2.45623 7.34163 2.67502C7.12284 2.89381 6.99992 3.19056 6.99992 3.49998V5.83331H5.83325C4.90499 5.83331 4.01476 6.20206 3.35838 6.85844C2.702 7.51482 2.33325 8.40506 2.33325 9.33331V10.5H25.6666V9.33331C25.6666 8.40506 25.2978 7.51482 24.6415 6.85844C23.9851 6.20206 23.0948 5.83331 22.1666 5.83331Z"
                    fill="#717579" />
            </svg>
            <span id="generalNotificationBadge" class="badge light text-white bg-danger rounded-circle">0</span>
        </a>
        <div class="dropdown-menu dropdown-menu-end">
            <div id="generalNotificationList" class="widget-timeline dlab-scroll style-1 p-3 height370">
                <ul class="timeline">
                    <li><p class="text-center text-muted">Keine neuen Benachrichtigungen</p></li>
                </ul>
            </div>
            <a class="all-notification" href="/notifications">Alle Benachrichtigungen anzeigen <i class="ti-arrow-end"></i></a>
        </div>
      </li>
      <script>
        async function loadGeneralNotifications() {
            try {
                const response = await fetch('/notifications');
                const data = await response.json();
      
                const notificationList = document.getElementById("generalNotificationList");
                const notificationBadge = document.getElementById("generalNotificationBadge");
      
                notificationList.innerHTML = "";
      
                // üóÇ LocalStorage ‚Äì Letzter Stand der Benachrichtigungen speichern
                let lastReadTimestamp = localStorage.getItem("lastReadNotifications") || "0";
                let unreadCount = 0;
      
                if (data.commissions.length === 0 && data.newPartners.length === 0) {
                    notificationList.innerHTML = `<li><p class="text-center text-muted">Keine neuen Benachrichtigungen</p></li>`;
                    notificationBadge.innerText = "";
                } else {
                    data.commissions.forEach(commission => {
                        const createdAt = new Date(commission.created_at).getTime();
                        const isNew = createdAt > lastReadTimestamp; // Pr√ºft, ob neue Benachrichtigung
      
                        const listItem = document.createElement("li");
                        listItem.innerHTML = `
                            <div class="timeline-badge success"></div>
                            <a class="timeline-panel text-muted" href="/commissions">
                                <span>${new Date(commission.created_at).toLocaleString()}</span>
                                <h6 class="mb-0">Neue Provision von ${commission.partner_name}: <strong class="text-success">‚Ç¨${commission.commission_amount.toFixed(2)}</strong></h6>
                            </a>
                        `;
                        notificationList.appendChild(listItem);
      
                        if (isNew) unreadCount++;
                    });
      
                    data.newPartners.forEach(partner => {
                        const createdAt = new Date(partner.created_at).getTime();
                        const isNew = createdAt > lastReadTimestamp;
      
                        const listItem = document.createElement("li");
                        listItem.innerHTML = `
                            <div class="timeline-badge primary"></div>
                            <a class="timeline-panel text-muted" href="/partners/${partner.id}">
                                <span>${new Date(partner.created_at).toLocaleString()}</span>
                                <h6 class="mb-0">Neuer Partner registriert: <strong class="text-primary">${partner.name}</strong></h6>
                            </a>
                        `;
                        notificationList.appendChild(listItem);
      
                        if (isNew) unreadCount++;
                    });
      
                    notificationBadge.innerText = unreadCount > 0 ? unreadCount : "";
                }
            } catch (error) {
                console.error("‚ùå Fehler beim Laden der Benachrichtigungen:", error);
            }
        }
      
        // üëá Klick auf Dropdown markiert Benachrichtigungen als gelesen & speichert Timestamp
        document.getElementById("notificationDropdown").addEventListener("click", async () => {
            const notificationBadge = document.getElementById("generalNotificationBadge");
            notificationBadge.innerText = ""; // üî• Setzt das Badge auf leer
      
            // ‚è± Speichere aktuellen Timestamp als "letztes Lesen"
            localStorage.setItem("lastReadNotifications", Date.now().toString());
      
            try {
                await fetch('/notifications/mark-as-read', { method: 'POST' }); // Sendet Info an Backend
            } catch (error) {
                console.error("‚ùå Fehler beim Markieren als gelesen:", error);
            }
        });
      
        // Alle 15 Sekunden aktualisieren
        setInterval(loadGeneralNotifications, 15000);
        loadGeneralNotifications();
      </script>
      <li class="nav-item dropdown  header-profile">
        <a class="nav-link" href="javascript:void(0);" role="button" data-bs-toggle="dropdown">
          <img src="/assets/images/weblogo.svg" width="56" alt="">
        </a>
        <div class="dropdown-menu dropdown-menu-end">
          <a href="app-profile" class="dropdown-item ai-icon">
            <svg id="icon-user1" xmlns="http://www.w3.org/2000/svg" class="text-primary" width="18" height="18"
              viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
            <span class="ms-2">Profile </span>
          </a>
          <a href="/messages" class="dropdown-item ai-icon">
            <svg id="icon-inbox" xmlns="http://www.w3.org/2000/svg" class="text-success" width="18" height="18"
              viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
              <polyline points="22,6 12,13 2,6"></polyline>
            </svg>
            <span class="ms-2">Nachrichten </span>
          </a>
          <a href="logout" class="dropdown-item ai-icon">
            <svg id="icon-logout" xmlns="http://www.w3.org/2000/svg" class="text-danger" width="18" height="18"
              viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
              <polyline points="16 17 21 12 16 7"></polyline>
              <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
            <span class="ms-2">Logout </span>
          </a>
        </div>
      </li>
      </ul>
  </div>
  </nav>
</div>
</div>